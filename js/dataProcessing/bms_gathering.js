import gui_elements from"../gui_elements";import sf from"../helpers/small_functions";export default class bmsGatherer extends gui_elements{lastLoggingDataTimeStamp=Date.now();hertzSampleBuffer=[];providedDataLabels=["bmsU1","bmsU2","bmsU3","bmsUOut","bmsI1","bmsI2","bmsI3","bmsStateMachineState"];constructor(t){super(),this.bmsConfig=t}initDataDistribution(t){this.dd=t,this.dd.addProvidedDataLabels(this.providedDataLabels)}gatherData(t){var e,i,n,a,s,g,l,h,m,U,d,r,u,t=t.target.value;if(0===t.byteLength)console.log("Something wrong with incoming BLE data!");else{if(this.bmsConfig.initialised)return this.lastLoggingDataTimeStamp=Date.now(),e=t.getUint8(2)<<8|t.getUint8(1),this.hertzSampleBuffer.push([e,this.lastLoggingDataTimeStamp]),this.hertzSampleBuffer.forEach(t=>{t[1]+1e3<Date.now()&&-1<(t=this.hertzSampleBuffer.indexOf(t))&&this.hertzSampleBuffer.splice(t,1)}),sf.setValueTexts(this.bmsDataLoggingFrequencyValues,"BMS: "+this.hertzSampleBuffer.length+"Hz"),i=(t.getUint8(10)<<8|t.getUint8(9))/100,n=(t.getUint8(12)<<8|t.getUint8(11))/100,a=(t.getUint8(14)<<8|t.getUint8(13))/100,s=(t.getUint8(16)<<8|t.getUint8(15))/100,g=sf.handleSignedBullshit(t.getUint8(4)<<8|t.getUint8(3))/100,l=sf.handleSignedBullshit(t.getUint8(6)<<8|t.getUint8(5))/100,h=sf.handleSignedBullshit(t.getUint8(8)<<8|t.getUint8(7))/100,m=(t.getUint8(18)<<8|t.getUint8(17))/10,U=(t.getUint8(20)<<8|t.getUint8(19))/10,d=t.getUint8(21),r=sf.handleSignedBullshit32(t.getUint8(25)<<24|t.getUint8(24)<<16|t.getUint8(23)<<8|t.getUint8(22)),u=sf.handleSignedBullshit32(t.getUint8(29)<<24|t.getUint8(28)<<16|t.getUint8(27)<<8|t.getUint8(26)),t=sf.handleSignedBullshit32(t.getUint8(33)<<24|t.getUint8(32)<<16|t.getUint8(31)<<8|t.getUint8(30)),this.dd.updateProvidedData({bmsU1:i,bmsU2:n,bmsU3:a,bmsUOut:s,bmsI1:g,bmsI2:l,bmsI3:h,bmsStateMachineState:d}),this.dd.executeMapping(),this.dd.updateDataExpecters(),{time:this.lastLoggingDataTimeStamp,packageSequenceNumber:e,u1:i,u2:n,u3:a,uOut:s,i1:g,i2:l,i3:h,tShunt:m,tPch:U,eU1:r,eU2:u,eU3:t,stateMachineState:d};console.log("waiting for config to be read...")}}}