import sf from"../helpers/small_functions";import gui_elements from"../gui_elements";export default class serviceWorkerInit extends gui_elements{constructor(){super();let t=!1;function i(e){confirm("The deployment has a newer interface version. Would you like to update now?Note: to apply the update, after pressing ok, please close and reopen the app.")&&e.waiting&&e.waiting.postMessage("SKIP_WAITING")}window.onload=function(){t=!0},navigator.serviceWorker.ready.then(async e=>{e.active&&(await sf.until(e=>t),e.active.postMessage("GET_VERSION"))}),navigator.serviceWorker.addEventListener("message",e=>{"version"===e.data.msg&&(e=e.data.version.split("-v")[1],sf.setValueTexts(this.interfaceVersionFields,e))}),"serviceWorker"in navigator&&window.addEventListener("load",async()=>{const e=await navigator.serviceWorker.register("serviceworker.js");e.waiting&&i(e),e.addEventListener("updatefound",()=>{e.installing&&e.installing.addEventListener("statechange",()=>{e.waiting&&(navigator.serviceWorker.controller?i(e):console.log("Service Worker initialized for the first time"))})});let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(window.location.reload(),t=!0)})})}}