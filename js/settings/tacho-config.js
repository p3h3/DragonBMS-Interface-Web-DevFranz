class tachoConfig{tempSensorType;divider_r;ntc_r;ntc_b;impulses;reversed;backwards_negative;motor_poles;initialPulseValue=0;currentPulseValue=0;constructor(){this.initialised=!1,this.#blurAppropriateTempFields(),this.#setStandardNTCValues(),tempSensorSelector.addEventListener("change",()=>{this.#blurAppropriateTempFields(),this.#setStandardNTCValues()}),getId("resetPulses").addEventListener("click",e=>{this.initialPulseValue=this.currentPulseValue}),getId("calculatedistperpulse").addEventListener("click",()=>{this.#calculateDistancePerPulse()})}indicateSuccess(e){inlineConfigContainer.classList.add("success"),setTimeout(()=>{inlineConfigContainer.classList.remove("success")},e)}indicateFailure(){inlineConfigContainer.classList.add("fault"),setTimeout(()=>{inlineConfigContainer.classList.remove("fault")},2e3)}#blurAppropriateTempFields(){var e=tempSensorSelector.options[tempSensorSelector.selectedIndex].value;if("ntc_custom"!==e&&"ptc_custom"!==e){var t=document.getElementsByClassName("customTempInput");for(let e=0;e<t.length;e++)t[e].style.opacity="0.5",t[e].style.pointerEvents="none"}else{var i=document.getElementsByClassName("customTempInput");for(let e=0;e<i.length;e++)i[e].style.opacity="1",i[e].style.pointerEvents=""}}#setStandardNTCValues(){var e=tempSensorSelector.options[tempSensorSelector.selectedIndex].value;"ntc10k"===e?(getId("r-value").value="29400",getId("b-value").value="3460"):"ntc100k"===e?(getId("r-value").value="350000",getId("b-value").value="4334"):(getId("r-value").value="",getId("b-value").value="")}#checkInlineConfigPlausibility(){setValueBacktoBoundaries("battery-cells",4,30),setValueBacktoBoundaries("battery-capacity",0,1e7),setValueBacktoBoundaries("max-cell-voltage",2e3,5e3),setValueBacktoBoundaries("min-cell-voltage",2e3,5e3),setValueBacktoBoundaries("strand-max-imbalance-current",0,100),setValueBacktoBoundaries("strand-max-current",1,300),setValueBacktoBoundaries("power-max-temp",30,90),setValueBacktoBoundaries("logic-max-temp",30,90),setValueBacktoBoundaries("precharge-current-limit",1,50),setValueBacktoBoundaries("load-capacitance",1,1e5),setValueBacktoBoundaries("datalogging-update-interval",20,255),setValueBacktoBoundaries("auto-poweroff",30,90)}#getTempSensorType(){var e=getId("ntc-type-select").value;return"kty83"===e?1:"kty84"===e?2:0}#setTempSensorType(e){1===e&&(getId("ntc-type-select").value="kty83"),2===e&&(getId("ntc-type-select").value="kty84"),0===e&&(getId("ntc-type-select").value="ntc_custom"),this.#blurAppropriateTempFields(),this.#setStandardNTCValues()}readInBuffer(e){this.tempSensorType=e.getUint8(0),this.divider_r=e.getUint8(2)<<8|e.getUint8(1),this.ntc_r=e.getUint8(4)<<8|e.getUint8(3),this.ntc_b=e.getUint8(6)<<8|e.getUint8(5),this.impulses=e.getUint8(8)<<8|e.getUint8(7),this.reversed=e.getUint8(9),this.backwards_negative=e.getUint8(10),this.motor_poles=e.getUint8(11);try{this.dataLoggingUpdateInterval=e.getUint8(15)<<8|e.getUint8(14)}catch(e){e.constructor===RangeError&&console.log("[inline config] fw doesn't support dl_update_interval")}this.initialised=!0}readInGUIElements(){this.tempSensorType=this.#getTempSensorType(),this.ntc_r=getIdValue("r-value")/10,this.divider_r=getIdValue("r-value-divider")/10,this.ntc_b=parseInt(getIdValue("b-value")),this.reversed=getIdChecked("reversed"),this.backwards_negative=getIdChecked("back-neg"),this.impulses=parseInt(getIdValue("distperpulse")),this.motor_poles=parseInt(getIdValue("motor-poles")),inlineConfigDataLoggingFrequency.disabled||(this.dataLoggingUpdateInterval=1e3/inlineConfigDataLoggingFrequency.value)}getBuffer(){var e;if(this.initialised)return(e=[])[0]=parseInt(this.tempSensorType),e[1]=to16bit(this.divider_r)[0],e[2]=to16bit(this.divider_r)[1],e[3]=to16bit(this.ntc_r)[0],e[4]=to16bit(this.ntc_r)[1],e[5]=to16bit(this.ntc_b)[0],e[6]=to16bit(this.ntc_b)[1],e[7]=to16bit(this.impulses)[0],e[8]=to16bit(this.impulses)[1],e[9]=this.reversed,e[10]=this.backwards_negative,e[11]=this.motor_poles,void 0!==this.dataLoggingUpdateInterval?(e[15]=to16bit(this.dataLoggingUpdateInterval)[0],e[14]=to16bit(this.dataLoggingUpdateInterval)[1],e[12]=0,e[13]=0):console.log("[tacho config] fw doesn't support dl_update_interval"),e}setGUIElements(){this.#setTempSensorType(this.tempSensorType),getId("r-value").value=10*this.ntc_r,getId("r-value-divider").value=10*this.divider_r,getId("b-value").value=this.ntc_b,getId("reversed").checked=this.reversed,getId("back-neg").checked=this.backwards_negative,getId("distperpulse").value=this.impulses,getId("motor-poles").value=this.motor_poles,void 0!==this.dataLoggingUpdateInterval?(inlineConfigDataLoggingFrequency.disabled=!1,getId("inline-dl-frequency").value=this.dataLoggingUpdateInterval):inlineConfigDataLoggingFrequency.disabled=!0}updatePulseCount(e){this.currentPulseValue=e,getId("pulses").innerHTML=String(parseFloat(e)-this.initialPulseValue)}#calculateDistancePerPulse(){var e=parseFloat(getId("pulses").innerHTML),t=parseFloat(getId("distance").value);0===e?(getId("pulses").style.color="red",setTimeout(()=>{getId("pulses").style.color=""},500)):getId("distperpulse").value=Math.abs(Math.round(10*t/e))}}function readInlineConfig(t){tachoObj.inlineConfigCharacteristic.readValue().then(e=>{tachoConfigObj.readInBuffer(e),tachoConfigObj.setGUIElements(),t()}).catch(e=>{tachoConfigObj.indicateFailure()})}getId("inline-config-read").addEventListener("click",()=>{readInlineConfig(()=>{tachoConfigObj.indicateSuccess(500)})}),getId("inline-config-write").addEventListener("click",()=>{tachoConfigObj.readInGUIElements(),tachoObj.inlineConfigCharacteristic.writeValue(Uint8Array.from(tachoConfigObj.getBuffer()).buffer).then(()=>{tachoConfigObj.indicateSuccess(3e3),console.log("successfully wrote config"),setTimeout(()=>{readInlineConfig(()=>{})},200)}).catch(e=>{tachoConfigObj.indicateFailure()})}),tachoResetTripOdoButton.addEventListener("click",()=>{tachoObj.inlineOdometerCharacteristic.writeValueWithoutResponse(Uint8Array.from([1]).buffer).catch(e=>{console.log("failed to reset trip odometer")})}),tachoResetVehicleOdoButton.addEventListener("click",()=>{tachoObj.inlineOdometerCharacteristic.writeValueWithoutResponse(Uint8Array.from([2]).buffer).catch(e=>{console.log("failed to reset vehicle odometer")})});