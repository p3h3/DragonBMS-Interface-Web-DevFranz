import sf from"../helpers/small_functions";import gui_elements from"../gui_elements";import Keyboard from"simple-keyboard";export default class virtualKeyboard extends gui_elements{focussedInput;hideKeyboard=!1;interfaceSettingsContainerLastSeen=0;constructor(){super(),sf.mobileDevice()?(this.keyboard=new Keyboard({onChange:e=>this.onChange(e),layout:{default:["1 2 3","4 5 6","7 8 9",". 0 {bksp}"]},theme:"hg-theme-default hg-layout-numeric numeric-theme",display:{"{bksp}":"del"}}),window.addEventListener("scroll",()=>{this.keyboardShouldBeVisible()&&this.keyboardContainer.classList.contains("hidden")&&(this.hideKeyboard||(this.keyboardContainer.classList.remove("hidden"),this.keyboardContainer.addEventListener("animationend",()=>{this.keyboardContainer.classList.remove("blend-in")},{once:!0}),this.keyboardContainer.classList.add("blend-in"))),this.keyboardShouldBeVisible()||this.keyboardContainer.classList.contains("hidden")||(this.keyboardContainer.addEventListener("animationend",()=>{this.keyboardContainer.classList.add("hidden"),this.keyboardContainer.classList.remove("blend-out")},{once:!0}),this.keyboardContainer.classList.add("blend-out")),sf.isScrolledIntoView(this.interfaceSettingsContainer)&&(this.interfaceSettingsContainerLastSeen=Date.now()),1e3<Date.now()-this.interfaceSettingsContainerLastSeen&&!this.interfaceSettingsContainer.classList.contains("hidden")&&this.interfaceSettingsContainer.classList.add("hidden")}),document.querySelectorAll("input[type='number']").forEach(e=>{e.addEventListener("focus",e=>{e.target.blur(),document.querySelectorAll("input").forEach(e=>{e.classList.remove("accent")}),e.target.classList.add("accent");const t=e.target.value;e.target.value="",setTimeout(()=>{e.target.value=t},1),this.focussedInput=e.target,this.keyboard.setInput(t)})}),document.querySelectorAll(".coloris").forEach(e=>{e.addEventListener("click",e=>{e.target.blur()})}),document.querySelectorAll("input[type='text']").forEach(e=>{e.addEventListener("focus",e=>{document.querySelectorAll("input").forEach(e=>{e.classList.remove("accent")}),e.target.classList.add("accent"),this.keyboardContainer.classList.add("hidden"),this.hideKeyboard=!0;const t=e.target.value;e.target.value="",setTimeout(()=>{e.target.value=t},1)}),e.addEventListener("focusout",e=>{e.target.classList.remove("accent"),this.hideKeyboard=!1,this.keyboardContainer.classList.remove("hidden")})})):window.addEventListener("scroll",()=>{sf.isScrolledIntoView(this.interfaceSettingsContainer)&&(this.interfaceSettingsContainerLastSeen=Date.now()),1e3<Date.now()-this.interfaceSettingsContainerLastSeen&&!this.interfaceSettingsContainer.classList.contains("hidden")&&this.interfaceSettingsContainer.classList.add("hidden")})}onChange(e){let t=!1;"."===(e=1<e.split(".").length-1?e.split(".").slice(0,-1).join("")+"."+e.split(".").slice(-1):e).charAt(e.length-1)?t=!0:t?this.focussedInput.value=e.substring(0,e.length-1):this.focussedInput.value=e}keyboardShouldBeVisible(){var e=[...document.querySelectorAll("#board-configuration-div [type='number']"),...document.querySelectorAll("#inline-configuration-div [type='number']"),...document.querySelectorAll("#board-calibration-div [type='number']"),...document.querySelectorAll("#interface-settings-container [type='number']")];let t=!1;return e.forEach(e=>{sf.isScrolledIntoViewWithKeyboard(e)&&(t=!0)}),t||sf.isScrolledIntoViewWithKeyboard(this.boardConfigContainer)||sf.isScrolledIntoViewWithKeyboard(this.boardCalibContainer)||sf.isScrolledIntoViewWithKeyboard(this.inlineConfigContainer)||sf.isScrolledIntoViewWithKeyboard(this.interfaceSettingsContainer)}}